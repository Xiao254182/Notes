#### K8s笔记

1.docker和containerd的命令对比

| 镜像相关功能     | Docker                    | Containerd                                    |
| ---------------- | ------------------------- | --------------------------------------------- |
| 显示本地镜像列表 | docker images             | ctr -n \<namespace> images ls                 |
| 下载镜像         | docker pull               | ctr -n \<namespace>  images pull              |
| 上传镜像         | docker push               | ctr -n \<namespace>  images push              |
| 删除本地镜像     | docker rmi                | ctr -n \<namespace> delete                    |
| 查看镜像详情     | docker inspect IMAGE-ID   | crictl inspecti IMAGE-ID                      |
| 导出离线镜像     | docker save xxx > xxx.tar | ctr -n \<namespace> images export xxx.tar xxx |
| 导入离线镜像     | docker load -i xxx.tar    | ctr -n \<namespace> images import xxx.tar     |

| 容器相关功能 | Docker         | Containerd     |
| ------------ | -------------- | -------------- |
| 显示容器列表 | docker ps      | crictl ps      |
| 创建容器     | docker create  | crictl create  |
| 启动容器     | docker start   | crictl start   |
| 停止容器     | docker stop    | crictl stop    |
| 删除容器     | docker rm      | crictl rm      |
| 查看容器详情 | docker inspect | crictl inspect |
| attach       | docker attach  | crictl attach  |
| exec         | docker exec    | crictl exec    |
| 查看日志     | docker logs    | crictl logs    |
| 查看状态     | docker stats   | crictl stats   |

Containerd新增了管理pod的功能，但一般不常用

| POD 相关功能  | Containerd      |
| ------------- | --------------- |
| 显示 POD 列表 | crictl pods     |
| 查看 POD 详情 | crictl inspectp |
| 运行 POD      | crictl runp     |
| 停止 POD      | crictl stopp    |

2.k8s删除namespaces状态一直为terminating问题处理

```shell
# kubectl get ns
NAME              STATUS        AGE
default           Active        5d4h
ingress-nginx     Active        30h
kube-node-lease   Active        5d4h
kube-public       Active        5d4h
kube-system       Active        5d4h
kubevirt          Terminating   2d2h   # <------ here

1、新开一个窗口运行命令  kubectl proxy
> 此命令启动了一个代理服务来接收来自你本机的HTTP连接并转发至API服务器，同时处理身份认证

2、新开一个终端窗口，将下面shell脚本整理到文本内`1.sh`并执行，$1参数即为删除不了的ns名称
#------------------------------------------------------------------------------------
#!/bin/bash

set -eo pipefail

die() { echo "$*" 1>&2 ; exit 1; }

need() {
        which "$1" &>/dev/null || die "Binary '$1' is missing but required"
}

# checking pre-reqs

need "jq"
need "curl"
need "kubectl"

PROJECT="$1"
shift

test -n "$PROJECT" || die "Missing arguments: kill-ns <namespace>"

kubectl proxy &>/dev/null &
PROXY_PID=$!
killproxy () {
        kill $PROXY_PID
}
trap killproxy EXIT

sleep 1 # give the proxy a second

kubectl get namespace "$PROJECT" -o json | jq 'del(.spec.finalizers[] | select("kubernetes"))' | curl -s -k -H "Content-Type: application/json" -X PUT -o /dev/null --data-binary @- http://localhost:8001/api/v1/namespaces/$PROJECT/finalize && echo "Killed namespace: $PROJECT"
#------------------------------------------------------------------------------------

3. 执行脚本删除
# bash 1.sh kubevirt
Killed namespace: kubevirt
1.sh: line 23: kill: (9098) - No such process

5、查看结果
# kubectl get ns    
NAME              STATUS   AGE
default           Active   5d4h
ingress-nginx     Active   30h
kube-node-lease   Active   5d4h
kube-public       Active   5d4h
kube-system       Active   5d4h
```

3. 
